---
id: T-023-05
story: S-023
title: PDF Export
status: ready
priority: 2
complexity: L
dependencies:
  - T-023-04
---

# T-023-05: PDF Export

## Objective

Generate a professional planting plan PDF that users can download, print, email, or share. The PDF is the tangible deliverable that coordinates homeowner, designer, and landscaper.

## Requirements

### Export Trigger

In Plan phase panel:
- "Generate PDF" button (primary action)
- Shows progress indicator while generating
- Downloads PDF or opens in new tab on completion

### PDF Content Structure

**Page 1: Cover/Summary**
- Title: "Planting Plan"
- Property address and coordinates
- Date generated
- Analysis period (e.g., "Growing Season: Apr 1 - Oct 31")
- Summary stats:
  - Total area
  - Number of zones
  - Number of plant species
  - Total plant count
- Light category summary: "2 full sun beds, 1 part shade bed"

**Page 2: Overhead Plan**
- Plan canvas rendered as image (same as Plan view)
- Scale: 1" = 10' or appropriate for paper size
- North arrow, scale bar
- Legend: zone colors + plant codes
- All zones labeled
- All plants shown with codes

**Page 3+: Plant Schedule**
Table with columns:
| Code | Common Name | Botanical Name | Qty | Size | Mature (H×W) | Spacing | Zone(s) |
|------|-------------|----------------|-----|------|--------------|---------|---------|
| LV   | Lavender    | Lavandula angustifolia | 5 | 1 gal | 2'×3' | 30" | Bed A |
| RS   | Rosemary    | Salvia rosmarinus | 3 | 1 gal | 3'×4' | 36" | Bed A |

Sort by zone, then alphabetically by common name.

**Page 4+: Zone Details (optional)**
Per zone:
- Zone name and light category
- Sun hours: average and range
- Area
- Plants in this zone with quantities
- Zone-specific notes (if any)

**Final Page: Growing Notes**
- General care guidance
- Watering recommendations
- Seasonal maintenance tasks
- Attribution/footer: "Generated by Solar-Sim"

### Format Specifications

- **Paper size**: Letter (8.5" × 11") for US, with A4 option
- **Orientation**: Portrait for most pages, landscape option for wide plans
- **Margins**: 0.5" minimum for printability
- **Fonts**: Clean sans-serif (system fonts for reliability)
- **Colors**: Should be readable when printed in grayscale
- **File size**: Target <2MB for easy emailing

### Branding (Minimal)

- Small Solar-Sim logo or text in footer
- Optional: space for user/company branding (future feature)

## Technical Approach

### Library Selection

**jsPDF** is the recommended library:
- Client-side PDF generation (no server required)
- Good table support via jspdf-autotable plugin
- Can embed images
- Well-documented, widely used

Alternative: **pdfmake** offers a more declarative API but larger bundle size.

### Plan Image Generation

1. Render PlanCanvas to a hidden canvas element at higher resolution (2x for clarity)
2. Export canvas as PNG data URL
3. Embed in PDF at appropriate scale

### Implementation Steps

1. Install jsPDF and jspdf-autotable
2. Create `generatePlanPdf()` function in `src/lib/export/`
3. Accept plan state (zones, plants, location, metadata)
4. Build PDF page by page
5. Return blob or trigger download

### Data Requirements

Function needs:
```typescript
interface PdfExportData {
  location: { lat: number; lng: number; name: string; address?: string };
  analysisPeriod: { start: Date; end: Date };
  zones: Zone[];
  plants: Plant[]; // full plant records for schedule
  planImageDataUrl: string; // rendered plan canvas
  generatedAt: Date;
}
```

## Acceptance Criteria

- [ ] "Generate PDF" button in Plan phase
- [ ] PDF generates entirely client-side (no server call)
- [ ] Cover page shows address, date, summary stats
- [ ] Overhead plan page shows zones and plants at scale
- [ ] Plant schedule table lists all plants with full details
- [ ] PDF is readable when printed in grayscale
- [ ] File downloads with sensible name (e.g., "planting-plan-123-main-st.pdf")
- [ ] Generation completes in <5 seconds for typical plans
- [ ] Works on iPad Safari

## Files to Create/Modify

- New: `src/lib/export/pdf.ts` — PDF generation logic
- New: `src/lib/export/index.ts` — export module entry
- Modify: `src/routes/results/+page.svelte` — add export button and handler
- Modify: `package.json` — add jsPDF dependency
